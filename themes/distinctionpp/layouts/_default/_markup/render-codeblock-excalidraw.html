{{ .Page.Store.Set "themeExtensionHasExcalidraw" true }}
{{- $id := printf "excalidraw-diagram-%d" .Ordinal -}}
{{- $dataId := printf "%s-data" $id -}}
{{- $json := .Inner | replaceRE `(?i)</script>` `<\\/script>` -}}
{{- $attrs := .Attributes -}}
{{- $width := index $attrs "width" | default "100%" -}}
{{- $height := index $attrs "height" | default "auto" -}}
{{- $style := index $attrs "style" | default "" -}}
{{- $class := index $attrs "class" | default "" -}}
{{- $containerStyle := printf "width: %s; height: %s; margin: 1rem 0;%s" $width $height (cond (ne $style "") (printf " %s" $style) "") -}}
<div class="excalidraw-container{{ with $class }} {{ . }}{{ end }}" style="{{ $containerStyle | safeCSS }}">
  <div id="{{ $id | safeHTMLAttr }}" class="excalidraw-root" style="width: 100%; height: auto;" data-excalidraw-data-id="{{ $dataId | safeHTMLAttr }}">Loading excalidraw libraries...</div>
</div>
<script type="application/json" id="{{ $dataId | safeHTMLAttr }}">{{ $json | safeJS }}</script>
